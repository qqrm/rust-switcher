name: Release PR

# This workflow uses Google's release-please action to automate creation of
# release pull requests for the crate.  It runs on pushes to the dev
# branch, inspects commits since the last release, and opens a PR that
# bumps the version and generates changelog entries.  When the PR is
# merged, release-please will tag the commit and create a GitHub release.

on:
  push:
    branches:
      - dev
  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Release-please
        uses: google-github-actions/release-please-action@v4
        with:
          # Specify the type of project. Rust crates use the 'rust' release type,
          # which will update Cargo.toml and Cargo.lock and generate release
          # notes. See https://github.com/googleapis/release-please for details.
          release-type: rust
          # Name of the crate as published to crates.io.  This should match
          # package.name in Cargo.toml.
          package-name: rust-switcher
          # The branch on which release pull requests are opened.  Use
          # the development branch of your repository.
          default-branch: dev
          # Path to the version file.  release-please will update this file
          # with the new version.  Cargo.toml is standard for Rust crates.
          version-file: Cargo.toml
          # Additional files to update.  Including Cargo.lock ensures the
          # locked dependencies reflect the bumped version.
          extra-files: Cargo.lock
          # Enable release creation.  When the PR is merged, release-please
          # will tag the release and create a GitHub release with notes.
          create-release: true
          # Use the GitHub token provided by Actions.  The token needs
          # permission to create PRs and releases.
          token: ${{ secrets.GITHUB_TOKEN }}
